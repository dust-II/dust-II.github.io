<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>æ ‘çŠ¶æ•°ç»„ï¼ˆFenwick Treeï¼‰ | My Blog</title>
<meta name=keywords content="æ ‘,rmq"><meta name=description content="xxxxxxxxxxxxxxxxxx"><meta name=author content="pk"><link rel=canonical href=https://dust-II.github.io/posts/1-01-01-test/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://dust-II.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dust-II.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dust-II.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://dust-II.github.io/apple-touch-icon.png><link rel=mask-icon href=https://dust-II.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://dust-II.github.io/posts/1-01-01-test/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://dust-II.github.io/posts/1-01-01-test/"><meta property="og:site_name" content="My Blog"><meta property="og:title" content="æ ‘çŠ¶æ•°ç»„ï¼ˆFenwick Treeï¼‰"><meta property="og:description" content="xxxxxxxxxxxxxxxxxx"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:tag" content="æ ‘"><meta property="article:tag" content="Rmq"><meta name=twitter:card content="summary"><meta name=twitter:title content="æ ‘çŠ¶æ•°ç»„ï¼ˆFenwick Treeï¼‰"><meta name=twitter:description content="xxxxxxxxxxxxxxxxxx"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dust-II.github.io/posts/"},{"@type":"ListItem","position":2,"name":"æ ‘çŠ¶æ•°ç»„ï¼ˆFenwick Treeï¼‰","item":"https://dust-II.github.io/posts/1-01-01-test/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"æ ‘çŠ¶æ•°ç»„ï¼ˆFenwick Treeï¼‰","name":"æ ‘çŠ¶æ•°ç»„ï¼ˆFenwick Treeï¼‰","description":"xxxxxxxxxxxxxxxxxx","keywords":["æ ‘","rmq"],"articleBody":"åŸæ•°ç»„ \u0026 å‰ç¼€å’Œæ•°ç»„ \u0026 å·®åˆ†æ•°ç»„ \u0026 æ ‘çŠ¶æ•°ç»„ è®¾æœ‰åŸæ•°ç»„ $nums$:\næ•°ç»„ $sum[i] nums[0] + nums[1] + â€¦ + nums[i]$ ç§°ä¸º $nums$ çš„å‰ç¼€å’Œæ•°ç»„ æ•°ç»„ $dif[i] = nums[i] - nums[i - 1]$ ç§°ä¸º $nums$ çš„å·®åˆ†æ•°ç»„ å‰ç¼€å’Œæ•°ç»„ã€å·®åˆ†æ•°ç»„ åªä¸è¿‡æ˜¯åŸæ•°ç»„çš„ä¸åŒè¡¨ç¤ºå½¢å¼ã€‚\nåŸæ•°ç»„å¯ä»¥åœ¨å¸¸æ•°æ—¶é—´å†…è®¿é—®ä»»æ„å…ƒç´ ï¼ï¼ï¼ å‰ç¼€å’Œæ•°ç»„å¯ä»¥åœ¨å¸¸æ•°æ—¶é—´è·å–ä»»æ„åŒºé—´çš„å…ƒç´ å’Œï¼ï¼ï¼ å·®åˆ†æ•°ç»„å¯ä»¥åœ¨å¸¸æ•°æ—¶é—´å†…å¯¹ä»»æ„åŒºé—´å†…å…ƒç´ å¢åŠ /å‡å°‘å›ºå®šæ•°å€¼ï¼ï¼ï¼ å‰ç¼€å’Œã€å·®åˆ†äº’ä¸ºé€†è¿ç®—ï¼š\nåŸæ•°ç»„ æ˜¯ å·®åˆ†æ•°ç»„ çš„å‰ç¼€å’Œæ•°ç»„ï¼ï¼ï¼ åŸæ•°ç»„ æ˜¯ å‰ç¼€å’Œæ•°ç»„ çš„å·®åˆ†æ•°ç»„ï¼ï¼ï¼ å‰ç¼€å’Œæ•°ç»„ï¼š\nç›´æ¥å­˜å‚¨äº†å‰ç¼€å’Œä¿¡æ¯ï¼› æ„å»ºæ—¶é—´å¤æ‚åº¦ï¼š $O(n)$ï¼› æŸ¥è¯¢åŸæ•°ç»„ä»»æ„åŒºé—´å†…å…ƒç´ çš„å’Œï¼š æ—¶é—´å¤æ‚åº¦ $O(1)$ï¼› ä¿®æ”¹åŸæ•°ç»„ä¸­æŸä¸ªå…ƒç´ çš„å€¼éœ€è¦å¯¹å‰ç¼€å’Œæ•°ç»„è¿›è¡Œç»´æŠ¤ï¼š æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ï¼› æ ‘çŠ¶æ•°ç»„ï¼š\né—´æ¥å­˜å‚¨äº†å‰ç¼€å’Œä¿¡æ¯ï¼Œè¢«åˆ†ä¸ºè¿ç»­çš„å¤šæ®µ æ„å»ºæ—¶é—´å¤æ‚åº¦ï¼š $O(n)$ï¼› æŸ¥è¯¢åŸæ•°ç»„ä»»æ„åŒºé—´å†…å…ƒç´ çš„å’Œï¼š å®é™…ä¸Šæ˜¯æŸ¥è¯¢ä¸¤æ¬¡å‰ç¼€å’Œï¼Œç„¶åä½œå·®ï¼›æ—¶é—´å¤æ‚åº¦ $O(logn)$ï¼› ä¿®æ”¹åŸæ•°ç»„ä¸­æŸä¸ªå…ƒç´ çš„å€¼éœ€è¦å¯¹æ ‘çŠ¶æ•°ç»„è¿›è¡Œç»´æŠ¤ï¼š æ—¶é—´å¤æ‚åº¦ä¸º $O(logn)$ï¼› æ ‘çŠ¶æ•°ç»„æ˜¯ä¸€ç§ â€œå…¼é¡¾å•ç‚¹ä¿®æ”¹ä¸åŒºé—´æŸ¥è¯¢å¹³è¡¡çš„ä¸€ç§æ•°æ®ç»“æ„â€\nåŸç† å…ˆä¸Šä»£ç ï¼Œç„¶åå†æ ¹æ®ä»£ç åå‘ç†è§£ï¼š\n$lowbit(x)$ æ˜¯ä»€ä¹ˆï¼Œå…¶ä½œç”¨åˆæ˜¯ä»€ä¹ˆï¼Ÿ æ ‘çŠ¶æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´  $ft[i]$ çš„å«ä¹‰ï¼Ÿ //nums è¡¨ç¤ºåŸæ•°ç»„ï¼Œft è¡¨ç¤º nums çš„æ ‘çŠ¶æ•°ç»„ //åŒå‰ç¼€å’Œæ•°ç»„ï¼Œæ ‘çŠ¶æ•°ç»„ä¹Ÿéœ€è¦è¡¥å……ä¸€ä¸ªå‰ç½® 0 class FenwickTree{ private: vector\u003cint\u003e ft; int lowbit(int x) { return x \u0026 (-x); } public: FenwickTree(int n) { ft.resize(n + 1, 0); } //ç¬¬ idx ä¸ªå…ƒç´  + x //nums[idx] + x when 1-indexed //nums[idx - 1] + x when 0-indexed void add(int idx, int x) { while(idx \u003c ft.size()) { ft[idx] += x; idx += lowbit(idx); } } //å‰ç¼€å’ŒæŸ¥è¯¢ int sum(int idx) { int res = 0; while(idx) { res += ft[idx]; idx -= lowbit(idx); } return res; } }; lowbit å‡½æ•° $lowbit$ æ˜¯ä»€ä¹ˆï¼Ÿ\n$lowbit(x)$ï¼š$x$ çš„äºŒè¿›åˆ¶è¡¨ç¤ºæœ€åä¸€ä½ $1$ çš„ä½æƒ $lowbit(x) = x\\ \u0026\\ (-x)$ x çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š0...1000000 x çš„åç ä¸ºï¼š 1...0111111 x çš„è¡¥ç ä¸ºï¼š 1...1000000ï¼ˆä¹Ÿå°±æ˜¯ -x çš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼‰ x \u0026 (-x)ï¼š 0...1000000 ç†è§£ æ ‘çŠ¶æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´  $ft[i]$ çš„å«ä¹‰ï¼Ÿæ¨¡æ‹Ÿæ±‚å’Œï¼ˆä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œè¿™é‡Œå‡è®¾åŸæ•°ç»„ $nums$ ä¸‹æ ‡ä¹Ÿä» $1$ å¼€å§‹ï¼‰ï¼š\n$sum[7] = ft[7] + ft[6] + ft[4]$ 7 çš„äºŒè¿›åˆ¶è¡¨ç¤º $111$ å®é™…ä¸Šï¼Œ$ft[7] = nums[7]$ å®é™…ä¸Šï¼Œ$ft[6] = nums[5] + nums[6]$ å®é™…ä¸Šï¼Œ$ft[4] = nums[1] + nums[2] + nums[3] + nums[4]$ çœ‹äº†ä¸Šé¢ä¾‹å­ï¼Œå¯¹äº $ft[i]$ çš„æœ¬è´¨åŸºæœ¬æœ‰æ„Ÿè§‰äº†å§ ğŸ¤”ğŸ¤” $ft[i]$ è¡¨ç¤ºçš„æ˜¯ $nums[i - lowbit(i) + 1] + â€¦ + nums[i]$ çš„å’Œï¼ï¼ï¼ $ft[i]$ ç»´æŠ¤çš„æ˜¯åŒºé—´ $[i - lowbit(i) + 1, i]$ çš„æ€§è´¨ $lowbit(x)$ åœ¨è¿™æœŸé—´çš„ä½œç”¨ï¼Ÿ\næ±‚å’ŒæœŸé—´ï¼šä»ä¸Šåˆ°ä¸‹ï¼Œå¿«é€Ÿè·³è½¬åˆ°ä¸‹ä¸€ä¸ªæ±‚å’ŒåŒºé—´ æ›´æ–°æœŸé—´ï¼šä»ä¸‹åˆ°ä¸Šï¼Œå¿«é€Ÿè·³è½¬åˆ°ä¸‹ä¸€å—å½±å“çš„åŒºé—´ åŒºé—´æœ€å€¼ Whatï¼Ÿï¼Ÿï¼Ÿæ ‘çŠ¶æ•°ç»„å¯ä»¥æ±‚ä»»æ„åŒºé—´å’Œæ˜¯å¯ä»¥ç†è§£çš„ï¼šæ±‚ä¸¤æ¬¡å‰ç¼€å’Œï¼Œåšå·®å³å¯å¾—åˆ°åŒºé—´å’Œã€‚æ ‘çŠ¶æ•°ç»„æ±‚ä»»æ„åŒºé—´æœ€å€¼ï¼Ÿï¼ï¼\nä¸€å¼€å§‹ä¹Ÿæ˜¯ä¸ç›¸ä¿¡çš„ï¼Œç„¶è€Œäº‹å®æ˜¯ï¼Œåœ¨ç‰¹å®šåœºæ™¯ä¸‹æ˜¯å¯è¡Œçš„ï¼Œè€Œä¸”æ•ˆæœè¿˜ä¸é”™ã€‚\nç‰¹å®šåœºæ™¯ï¼šæ±‚åŒºé—´æœ€å°/å¤§å€¼æ—¶ï¼Œè¦æ±‚ä¿®æ”¹æ–¹å‘åªèƒ½æœç€å˜å°/å¤§çš„æ–¹å‘ä¿®æ”¹ï¼ˆçº¿æ®µæ ‘æ˜¯æ²¡æœ‰è¿™è¦æ±‚çš„ï¼‰ï¼Œè€ƒè™‘åŒºé—´æœ€å¤§å€¼ï¼š\nå•ç‚¹æ›´æ–°ä¸‹ $nums[5] = 100$ï¼Œ$ft[5]$ï¼Œ$ft[6]$ï¼Œ$ft[8]$ å‡å—åˆ°å½±å“ï¼Œæ›´æ–°ä¸º $100$ï¼Œè¿™æ²¡é—®é¢˜ æ¥ç€æ›´æ–°ä¸‹ $nums[5] = 99$ï¼ŒæŒ‰é“ç† $ft[5]$ï¼Œ$ft[6]$ï¼Œ$ft[8]$ å‡åº”æ›´æ–°ä¸º $99$ï¼Œä½†å®é™…æ˜¯ä¸ä¼šæ›´æ–°çš„ï¼Œè¿™æ­£æ˜¯é—®é¢˜æ‰€åœ¨ï¼ å®ç° è¿™é‡Œä»¥æ±‚åŒºé—´æœ€å¤§å€¼ä¸ºä¾‹ï¼Œæ ¸å¿ƒæ€æƒ³ï¼š\næ›´æ–°çš„æ—¶å€™ä¸ä»…è¦ç»´æŠ¤æ ‘çŠ¶æ•°ç»„ $ft$ï¼Œè¿˜è¦ç»´æŠ¤åŸæ•°ç»„ $nums$ æŸ¥è¯¢çš„æ—¶å€™ $[p, r]$ æœ€å€¼æœ´ç´ åšæ³•ï¼šä»èµ·ç‚¹åˆ°ç»ˆç‚¹é€ä¸ªéå†ï¼Œå–æœ€å¤§å€¼å³å¯ï¼Œå¯ä»¥ä½¿ç”¨ $ft$ å¯¹å…¶è¿›è¡Œä¼˜åŒ– è‹¥ $ft[i]$ æ‰€ç®¡ç†çš„åŒºé—´åœ¨æŸ¥è¯¢åŒºé—´èŒƒå›´å†…ï¼šç”¨ $ft[i]$ ä»£è¡¨å…¶æ‰€ç®¡ç†çš„åŒºé—´å³å¯ å¦‚æœ $ft[i]$ æ‰€ç®¡ç†çš„åŒºé—´å¹¶æ²¡æœ‰å®Œå…¨åœ¨æŸ¥è¯¢åŒºé—´å†…ï¼Œå›åˆ°æœ´ç´ åšæ³•å³å¯ï¼Œç”¨åŸæ˜¯æ•°ç»„ä¸­çš„å…ƒç´ åšæ¯”è¾ƒå³å¯ ç¤ºä¾‹ï¼šæŸ¥è¯¢åŒºé—´ $[3, 7]$\n$ft[7]$ ç®¡ç†çš„èŒƒå›´æ˜¯ $[7, 7]$ï¼Œå®Œå…¨åœ¨æŸ¥è¯¢èŒƒå›´å†… $ft[6]$ ç®¡ç†çš„èŒƒå›´æ˜¯ $[5, 6]$ï¼Œå®Œå…¨åœ¨æŸ¥è¯¢èŒƒå›´å†… $ft[4]$ ç®¡ç†çš„èŒƒå›´æ˜¯ $[1, 4]$ï¼Œä¸å®Œå…¨åœ¨æŸ¥è¯¢èŒƒå›´å†…ï¼Œä½¿ç”¨åŸæ•°ç»„å…ƒç´ ä»£è¡¨ $nums[4]$ $ft[3]$ ç®¡ç†çš„èŒƒå›´æ˜¯ $[3, 3]$ï¼Œå®Œå…¨åœ¨æŸ¥è¯¢èŒƒå›´å†… $max([3, 7]) = max(ft[7], ft[6], nums[4], ft[3])$ ç¦»æ•£åŒ– ç»´æŠ¤ç¦»æ•£åŒºé—´ å¸¸è§„ï¼šä¸‹æ ‡åŒºé—´æ˜¯è¿ç»­çš„ï¼Œç»´æŠ¤åŒºé—´ [5, 6] ä¹‹é—´çš„æœ€å€¼/å’Œ\nå¦‚æœä¸‹æ ‡åŒºé—´ä¸è¿ç»­å‘¢ï¼š\nèŒƒå›´å°çš„è¯ï¼Œå£°æ˜ä¸€ä¸ªæ•°ç»„ï¼Œå½“æˆè¿ç»­çš„å°±å¯ä»¥äº† èŒƒå›´ç‰¹åˆ«å¤§ï¼Œå°±æ²¡åŠæ³•å£°æ˜æ•°ç»„äº† è§£å†³åŠæ³•ï¼š\nå¯¹å‡ºç°è¿‡çš„ä¸‹æ ‡è¿›è¡Œæ’åºï¼Œæ’å®Œåºåï¼Œå»é‡ æ¯æ¬¡å…ˆç”¨äºŒåˆ†æŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾åˆ°å¯¹åº”çš„è¿ç»­ä¸‹æ ‡ //æ’åº sort(diff.begin(), diff.end()); //å»é‡ diff.resize(unique(diff.begin(), diff.end()) - diff.begin()); Fenwick fw(diff.size()); long long mx = LLONG_MIN; for(int i = 0; i \u003c n; ++i) { //ç¦»æ•£ä¸‹æ ‡è½¬åŒ–ä¸ºè¿ç»­ä¸‹æ ‡ int j = lower_bound(diff.begin(), diff.end(), nums[i] - i) - diff.begin(); long long temp = fw.query(j + 1) + nums[i]; fw.update(j + 1, temp); mx = max(mx, temp); } å°è£… æ”¯æŒåŒºé—´ å’Œã€ç§¯ã€ä¸å’Œã€æˆ–å’Œã€å¼‚æˆ–å’Œã€æœ€å¤§/å°å€¼ï¼ˆgcdï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼‰ç­‰åœºæ™¯çš„å•ç‚¹æ›´æ–°ï¼ŒåŒºé—´æŸ¥è¯¢æ“ä½œã€‚\nåªæ”¯æŒâ€œå¢é‡æ›´æ–°ï¼ˆupdateï¼‰â€ï¼Œä¸æ”¯æŒ â€œè®¾ç½®æ›´æ–°ï¼ˆsetï¼‰â€ å³ä½¿æ”¯æŒè®¾ç½®æ›´æ–°ï¼Œä¹Ÿæ˜¯é€šè¿‡å¢é‡æ›´æ–°å®ç°çš„ï¼Œå¦‚ å’Œã€ä¹˜ç§¯ã€å¼‚æˆ–å’Œã€‚å…¶ä»–åœºæ™¯æ˜¯ç§»é™¤ä¸æ‰æ—§æœ‰å…ƒç´ å½±å“çš„ï¼Œä½¿ç”¨èµ·æ¥å…·æœ‰çº¦æŸï¼Œä»¥æœ€å€¼åœºæ™¯ä¸ºä¾‹:\næœ€å¤§å€¼æŸ¥è¯¢ï¼šæ›´æ–°å€¼å¿…é¡»å¤§äºç­‰äºæ—§å€¼ æœ€å°å€¼æŸ¥è¯¢ï¼šæ›´æ–°å€¼å¿…é¡»å°äºç­‰äºæ—§å€¼ åŸç† + å®ç°çš„æ—¶å€™åŸºäº 1-indexed æ›´å¥½ç†è§£ï¼Œæ¥å£å°è£…éƒ½æ˜¯ 0-indexed ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼ï¼ï¼\n// Copyright (c) 2025 pk. All rights reserved. // Use of this source code is governed by a MIT license // if you like this code, don't delete this, thanks. // identity variable template(C++14) template\u003ctemplate\u003ctypename\u003e class Op, typename T\u003e constexpr auto identity_value = nullptr; // std::plus partial variable template specialization template\u003ctypename T\u003e constexpr auto identity_value\u003cstd::plus, T\u003e = T(0); // std::multiplies partial variable template specialization template\u003ctypename T\u003e constexpr auto identity_value\u003cstd::multiplies, T\u003e = T(1); // std::bit_and partial variable template specialization template\u003ctypename T\u003e constexpr auto identity_value\u003cstd::bit_and, T\u003e = ~T(0); // std::bit_or partial variable template specialization template\u003ctypename T\u003e constexpr auto identity_value\u003cstd::bit_or, T\u003e = T(0); // std::bit_xor partial variable template specialization template\u003ctypename T\u003e constexpr auto identity_value\u003cstd::bit_xor, T\u003e = T(0); // maximum partial variable template specialization // std::maximum is function template, not types of functors // float type should use lowest() instead of min() template\u003ctypename T\u003e struct maximum { constexpr T operator()(const T\u0026 lhs, const T\u0026 rhs) const { return std::max(lhs, rhs); } }; template\u003ctypename T\u003e constexpr auto identity_value\u003cmaximum , T\u003e = std::is_floating_point\u003cT\u003e::value ? std::numeric_limits\u003cT\u003e::lowest() : std::numeric_limits\u003cT\u003e::min(); // minimum partial variable template specialization // std::min is function template, not types of functors template\u003ctypename T\u003e struct minimum { constexpr T operator()(const T\u0026 lhs, const T\u0026 rhs) const { return std::min(lhs, rhs);} }; template\u003ctypename T\u003e constexpr auto identity_value\u003cminimum, T\u003e = std::numeric_limits\u003cT\u003e::max(); template\u003ctemplate\u003ctypename\u003e class Op, typename T\u003e class FenwickTree { public: explicit FenwickTree(const int n, const T\u0026 init_value = identity_value\u003cOp, T\u003e) : ori(n, init_value), ft(n + 1, identity_value\u003cOp, T\u003e) { linear_init(); } explicit FenwickTree(const std::vector\u003cT\u003e\u0026 nums) : ori(nums), ft(nums.size() + 1, identity_value\u003cOp, T\u003e) { linear_init(); } // 0-indexed const T\u0026 operator[](size_t idx) const { int n = ori.size(); if (idx \u003c 0 || idx \u003e= n) { throw std::out_of_range(\"index out of range\"); } return ori[idx]; } bool update(int idx, T x) { int n = ori.size(); if(idx \u003c 0 || idx \u003e= n) { throw std::out_of_range(\"index out of range\"); } ori[idx] = op(ori[idx], x); idx++; while(idx \u003c ft.size()) { ft[idx] = op(ft[idx], x); idx += lowbit(idx); } return true; } // 0-indexed [0, idx] T query(int idx) const { // change to 1-indexed idx++; T res = identity_value\u003cOp, T\u003e; // special scene should return identity if(idx \u003c 1) return res; // avoid Out-of-bounds access if(idx \u003e ori.size()) idx = ori.size(); while(idx) { res = op(res, ft[idx]); idx -= lowbit(idx); } return res; } // 0-indexed [p, r] T query(int p, int r) const { // change to 1-indexed p++, r++; int n = static_cast\u003cint\u003e(ori.size()); T res = identity_value\u003cOp, T\u003e; // special scene should return identity if(p \u003e r || r \u003c 1 || p \u003e n) return res; // void Out-of-bounds access if(p \u003c 1) p = 1; if(r \u003e n) r = n; while(p \u003c= r) { if(p \u003c= r - lowbit(r)) { res = op(res, ft[r]); r -= lowbit(r); } else { res = op(res, ori[--r]); } } return res; } private: static int lowbit(const int x) { return x \u0026 (-x); } void linear_init() { int n = ori.size(); for(int i = 1; i \u003c= n; ++i) { ft[i] = op(ft[i], ori[i - 1]); int idx = i + lowbit(i); if(idx \u003c= n) ft[idx] = op(ft[idx], ft[i]); } } std::vector\u003cT\u003e ori; std::vector\u003cT\u003e ft; Op\u003cT\u003e op; }; ä½¿ç”¨ç¤ºä¾‹\nstd::cout \u003c\u003c identity_value\u003cmaximum, int\u003e \u003c\u003c std::endl; std::cout \u003c\u003c identity_value\u003cminimum, int\u003e \u003c\u003c std::endl; std::cout \u003c\u003c identity_value\u003cmaximum, unsigned int\u003e \u003c\u003c std::endl; std::cout \u003c\u003c identity_value\u003cminimum, unsigned int\u003e \u003c\u003c std::endl; std::cout \u003c\u003c identity_value\u003cmaximum, long long\u003e \u003c\u003c std::endl; std::cout \u003c\u003c identity_value\u003cminimum, long long\u003e \u003c\u003c std::endl; std::cout \u003c\u003c identity_value\u003cmaximum, unsigned long long\u003e \u003c\u003c std::endl; std::cout \u003c\u003c identity_value\u003cminimum, unsigned long long\u003e \u003c\u003c std::endl; std::cout \u003c\u003c identity_value\u003cmaximum, float\u003e \u003c\u003c std::endl; std::cout \u003c\u003c identity_value\u003cminimum, float\u003e \u003c\u003c std::endl; std::cout \u003c\u003c identity_value\u003cmaximum, double\u003e \u003c\u003c std::endl; std::cout \u003c\u003c identity_value\u003cminimum, double\u003e \u003c\u003c std::endl; FenwickTree\u003cstd::plus, int\u003e ft(10); ft.update(0, 1); ft.update(1, 2); ft.update(9, 3); std::cout \u003c\u003c ft.query(9) \u003c\u003c std::endl; FenwickTree\u003cminimum, int\u003e ft1(10); åœ¨å®ç°å•ç‚¹æŸ¥è¯¢ã€åŒºé—´æŸ¥è¯¢æ—¶ï¼Œéœ€è¦æ³¨æ„ï¼š\nä¸è¦ç€æ€¥ç›´æ¥ä½¿ç”¨ clamp å¤„ç†è¾¹ç•Œï¼Œåº”è¯¥å…ˆåˆ¤æ–­ç‰¹æ®Šåœºæ™¯ å•ç‚¹æŸ¥è¯¢: idx == -2 æ—¶ï¼Œå®é™…åº”è¯¥è¿”å›å•ä½å…ƒï¼Œå¦‚æœå…ˆ clamp åˆ° idx == 0, è¿”å›çš„å¹¶ä¸æ˜¯å•ä½å…ƒ åŒºé—´æŸ¥è¯¢: p \u003e r || r \u003c 0 || p \u003e= ori.size() æ—¶éƒ½åº”è¯¥è¿”å›å•ä½å…ƒ åˆ¤æ–­å®Œç‰¹æ®Šåœºæ™¯ä¹‹åï¼Œéœ€è¦è¿›è¡Œ clampï¼Œé˜²æ­¢è®¿é—®è¶Šç•ŒåŒæ—¶ä¿è¯è®¡ç®—ç»“æœ å•ç‚¹æŸ¥è¯¢: idx == ori.size() + 3 æ—¶ï¼Œè®¡ç®—å‰åº”è¯¥ clamp åˆ° idx == ori.size() - 1 é˜²æ­¢è®¿é—®è¶Šç•Œ åŒºé—´æŸ¥è¯¢: ç‰¹æ®Šåœºæ™¯åˆ¤æ–­å®Œä¹‹åï¼Œè¿˜æœ‰å¯èƒ½æ˜¯ p \u003c 0 \u0026\u0026 r \u003e= ori.size() ç­‰åœºæ™¯ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦åš clamp çš„ ç»ƒä¹  std::plus:\nLeetCode 3187. æ•°ç»„ä¸­çš„å³°å€¼ LeetCode 1589. æ‰€æœ‰æ’åˆ—ä¸­çš„æœ€å¤§å’Œ LeetCode 2426. æ»¡è¶³ä¸ç­‰å¼çš„æ•°å¯¹æ•°ç›® LeetCode 2179. ç»Ÿè®¡æ•°ç»„ä¸­å¥½ä¸‰å…ƒç»„æ•°ç›® LeetCode 327. åŒºé—´å’Œçš„ä¸ªæ•° maximum:\nLeetCode 2926. å¹³è¡¡å­åºåˆ—çš„æœ€å¤§å’Œ LeetCode 2407. æœ€é•¿é€’å¢å­åºåˆ— II std::bit_or:\nLeetCode 3171. æ‰¾åˆ°æŒ‰ä½æˆ–æœ€æ¥è¿‘ K çš„å­æ•°ç»„ std::bit_and:\nLeetCode 1521. æ‰¾åˆ°æœ€æ¥è¿‘ç›®æ ‡å€¼çš„å‡½æ•°å€¼ ","wordCount":"1117","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"pk"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dust-II.github.io/posts/1-01-01-test/"},"publisher":{"@type":"Organization","name":"My Blog","logo":{"@type":"ImageObject","url":"https://dust-II.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://dust-II.github.io/ accesskey=h title="User's Blog (Alt + H)"><img src=https://dust-II.github.io/favicon.ico alt aria-label=logo height=35>User's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://dust-II.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://dust-II.github.io/archive/ title=Archive><span>Archive</span></a></li><li><a href=https://dust-II.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://dust-II.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dust-II.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://dust-II.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">æ ‘çŠ¶æ•°ç»„ï¼ˆFenwick Treeï¼‰</h1><div class=post-description>xxxxxxxxxxxxxxxxxx</div><div class=post-meta><span>1117 words</span>&nbsp;Â·&nbsp;<span>pk</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%8e%9f%e6%95%b0%e7%bb%84--%e5%89%8d%e7%bc%80%e5%92%8c%e6%95%b0%e7%bb%84--%e5%b7%ae%e5%88%86%e6%95%b0%e7%bb%84--%e6%a0%91%e7%8a%b6%e6%95%b0%e7%bb%84 aria-label="åŸæ•°ç»„ & å‰ç¼€å’Œæ•°ç»„ & å·®åˆ†æ•°ç»„ & æ ‘çŠ¶æ•°ç»„">åŸæ•°ç»„ & å‰ç¼€å’Œæ•°ç»„ & å·®åˆ†æ•°ç»„ & æ ‘çŠ¶æ•°ç»„</a></li><li><a href=#%e5%8e%9f%e7%90%86 aria-label=åŸç†>åŸç†</a><ul><li><a href=#lowbit-%e5%87%bd%e6%95%b0 aria-label="lowbit å‡½æ•°">lowbit å‡½æ•°</a></li><li><a href=#%e7%90%86%e8%a7%a3 aria-label=ç†è§£>ç†è§£</a></li></ul></li><li><a href=#%e5%8c%ba%e9%97%b4%e6%9c%80%e5%80%bc aria-label=åŒºé—´æœ€å€¼>åŒºé—´æœ€å€¼</a><ul><li><a href=#%e5%ae%9e%e7%8e%b0 aria-label=å®ç°>å®ç°</a></li></ul></li><li><a href=#%e7%a6%bb%e6%95%a3%e5%8c%96 aria-label=ç¦»æ•£åŒ–>ç¦»æ•£åŒ–</a><ul><li><a href=#%e7%bb%b4%e6%8a%a4%e7%a6%bb%e6%95%a3%e5%8c%ba%e9%97%b4 aria-label=ç»´æŠ¤ç¦»æ•£åŒºé—´>ç»´æŠ¤ç¦»æ•£åŒºé—´</a></li></ul></li><li><a href=#%e5%b0%81%e8%a3%85 aria-label=å°è£…>å°è£…</a></li><li><a href=#%e7%bb%83%e4%b9%a0 aria-label=ç»ƒä¹ >ç»ƒä¹ </a></li></ul></div></details></div><div class=post-content><h1 id=åŸæ•°ç»„--å‰ç¼€å’Œæ•°ç»„--å·®åˆ†æ•°ç»„--æ ‘çŠ¶æ•°ç»„>åŸæ•°ç»„ & å‰ç¼€å’Œæ•°ç»„ & å·®åˆ†æ•°ç»„ & æ ‘çŠ¶æ•°ç»„<a hidden class=anchor aria-hidden=true href=#åŸæ•°ç»„--å‰ç¼€å’Œæ•°ç»„--å·®åˆ†æ•°ç»„--æ ‘çŠ¶æ•°ç»„>#</a></h1><p>è®¾æœ‰åŸæ•°ç»„ $nums$:</p><ul><li>æ•°ç»„ $sum[i] nums[0] + nums[1] + &mldr; + nums[i]$ ç§°ä¸º $nums$ çš„å‰ç¼€å’Œæ•°ç»„</li><li>æ•°ç»„ $dif[i] = nums[i] - nums[i - 1]$ ç§°ä¸º $nums$ çš„å·®åˆ†æ•°ç»„</li></ul><p>å‰ç¼€å’Œæ•°ç»„ã€å·®åˆ†æ•°ç»„ åªä¸è¿‡æ˜¯åŸæ•°ç»„çš„ä¸åŒè¡¨ç¤ºå½¢å¼ã€‚</p><ul><li>åŸæ•°ç»„å¯ä»¥åœ¨å¸¸æ•°æ—¶é—´å†…è®¿é—®ä»»æ„å…ƒç´ ï¼ï¼ï¼</li><li>å‰ç¼€å’Œæ•°ç»„å¯ä»¥åœ¨å¸¸æ•°æ—¶é—´è·å–ä»»æ„åŒºé—´çš„å…ƒç´ å’Œï¼ï¼ï¼</li><li>å·®åˆ†æ•°ç»„å¯ä»¥åœ¨å¸¸æ•°æ—¶é—´å†…å¯¹ä»»æ„åŒºé—´å†…å…ƒç´ å¢åŠ /å‡å°‘å›ºå®šæ•°å€¼ï¼ï¼ï¼</li></ul><p>å‰ç¼€å’Œã€å·®åˆ†äº’ä¸ºé€†è¿ç®—ï¼š</p><ul><li>åŸæ•°ç»„ æ˜¯ å·®åˆ†æ•°ç»„ çš„å‰ç¼€å’Œæ•°ç»„ï¼ï¼ï¼</li><li>åŸæ•°ç»„ æ˜¯ å‰ç¼€å’Œæ•°ç»„ çš„å·®åˆ†æ•°ç»„ï¼ï¼ï¼</li></ul><p><img alt=/assets/content/1.png loading=lazy src=/assets/content/1.png></p><p>å‰ç¼€å’Œæ•°ç»„ï¼š</p><ul><li>ç›´æ¥å­˜å‚¨äº†å‰ç¼€å’Œä¿¡æ¯ï¼›</li><li><strong>æ„å»ºæ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(n)$ï¼›</li><li><strong>æŸ¥è¯¢åŸæ•°ç»„ä»»æ„åŒºé—´å†…å…ƒç´ çš„å’Œï¼š</strong> æ—¶é—´å¤æ‚åº¦ $O(1)$ï¼›</li><li><strong>ä¿®æ”¹åŸæ•°ç»„ä¸­æŸä¸ªå…ƒç´ çš„å€¼éœ€è¦å¯¹å‰ç¼€å’Œæ•°ç»„è¿›è¡Œç»´æŠ¤ï¼š</strong> æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ï¼›</li></ul><p>æ ‘çŠ¶æ•°ç»„ï¼š</p><ul><li>é—´æ¥å­˜å‚¨äº†å‰ç¼€å’Œä¿¡æ¯ï¼Œè¢«åˆ†ä¸ºè¿ç»­çš„å¤šæ®µ</li><li><strong>æ„å»ºæ—¶é—´å¤æ‚åº¦ï¼š</strong> $O(n)$ï¼›</li><li><strong>æŸ¥è¯¢åŸæ•°ç»„ä»»æ„åŒºé—´å†…å…ƒç´ çš„å’Œï¼š</strong> å®é™…ä¸Šæ˜¯æŸ¥è¯¢ä¸¤æ¬¡å‰ç¼€å’Œï¼Œç„¶åä½œå·®ï¼›æ—¶é—´å¤æ‚åº¦ $O(logn)$ï¼›</li><li><strong>ä¿®æ”¹åŸæ•°ç»„ä¸­æŸä¸ªå…ƒç´ çš„å€¼éœ€è¦å¯¹æ ‘çŠ¶æ•°ç»„è¿›è¡Œç»´æŠ¤ï¼š</strong> æ—¶é—´å¤æ‚åº¦ä¸º $O(logn)$ï¼›</li></ul><blockquote><p>æ ‘çŠ¶æ•°ç»„æ˜¯ä¸€ç§ â€œå…¼é¡¾å•ç‚¹ä¿®æ”¹ä¸åŒºé—´æŸ¥è¯¢å¹³è¡¡çš„ä¸€ç§æ•°æ®ç»“æ„â€</p></blockquote><h1 id=åŸç†>åŸç†<a hidden class=anchor aria-hidden=true href=#åŸç†>#</a></h1><p>å…ˆä¸Šä»£ç ï¼Œç„¶åå†æ ¹æ®ä»£ç åå‘ç†è§£ï¼š</p><ul><li>$lowbit(x)$ æ˜¯ä»€ä¹ˆï¼Œå…¶ä½œç”¨åˆæ˜¯ä»€ä¹ˆï¼Ÿ</li><li>æ ‘çŠ¶æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´  $ft[i]$ çš„å«ä¹‰ï¼Ÿ</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>//nums è¡¨ç¤ºåŸæ•°ç»„ï¼Œft è¡¨ç¤º nums çš„æ ‘çŠ¶æ•°ç»„
</span></span></span><span style=display:flex><span><span style=color:#75715e>//åŒå‰ç¼€å’Œæ•°ç»„ï¼Œæ ‘çŠ¶æ•°ç»„ä¹Ÿéœ€è¦è¡¥å……ä¸€ä¸ªå‰ç½® 0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FenwickTree</span>{
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span> ft;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>lowbit</span>(<span style=color:#66d9ef>int</span> x) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> x <span style=color:#f92672>&amp;</span> (<span style=color:#f92672>-</span>x);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    FenwickTree(<span style=color:#66d9ef>int</span> n) {
</span></span><span style=display:flex><span>        ft.resize(n <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>//ç¬¬ idx ä¸ªå…ƒç´  + x
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//nums[idx] + x when 1-indexed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//nums[idx - 1] + x when 0-indexed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>int</span> idx, <span style=color:#66d9ef>int</span> x) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span>(idx <span style=color:#f92672>&lt;</span> ft.size()) {
</span></span><span style=display:flex><span>            ft[idx] <span style=color:#f92672>+=</span> x;
</span></span><span style=display:flex><span>            idx <span style=color:#f92672>+=</span> lowbit(idx);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>//å‰ç¼€å’ŒæŸ¥è¯¢
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>sum</span>(<span style=color:#66d9ef>int</span> idx) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> res <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span>(idx) {
</span></span><span style=display:flex><span>            res <span style=color:#f92672>+=</span> ft[idx];
</span></span><span style=display:flex><span>            idx <span style=color:#f92672>-=</span> lowbit(idx);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> res;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h2 id=lowbit-å‡½æ•°>lowbit å‡½æ•°<a hidden class=anchor aria-hidden=true href=#lowbit-å‡½æ•°>#</a></h2><p>$lowbit$ æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>$lowbit(x)$ï¼š$x$ çš„äºŒè¿›åˆ¶è¡¨ç¤ºæœ€åä¸€ä½ $1$ çš„ä½æƒ</li><li>$lowbit(x) = x\ &\ (-x)$</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>x <span style=color:#960050;background-color:#1e0010>çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š</span><span style=color:#ae81ff>0.</span>.<span style=color:#ae81ff>.1000000</span>
</span></span><span style=display:flex><span>x <span style=color:#960050;background-color:#1e0010>çš„åç ä¸ºï¼š</span>     <span style=color:#ae81ff>1.</span>.<span style=color:#ae81ff>.0111111</span>
</span></span><span style=display:flex><span>x <span style=color:#960050;background-color:#1e0010>çš„è¡¥ç ä¸ºï¼š</span>     <span style=color:#ae81ff>1.</span>.<span style=color:#ae81ff>.1000000</span><span style=color:#960050;background-color:#1e0010>ï¼ˆä¹Ÿå°±æ˜¯</span> <span style=color:#f92672>-</span>x <span style=color:#960050;background-color:#1e0010>çš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼‰</span>
</span></span><span style=display:flex><span>x <span style=color:#f92672>&amp;</span> (<span style=color:#f92672>-</span>x)<span style=color:#960050;background-color:#1e0010>ï¼š</span>      <span style=color:#ae81ff>0.</span>.<span style=color:#ae81ff>.1000000</span>
</span></span></code></pre></div><h2 id=ç†è§£>ç†è§£<a hidden class=anchor aria-hidden=true href=#ç†è§£>#</a></h2><p>æ ‘çŠ¶æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´  $ft[i]$ çš„å«ä¹‰ï¼Ÿæ¨¡æ‹Ÿæ±‚å’Œï¼ˆä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œè¿™é‡Œå‡è®¾åŸæ•°ç»„ $nums$ ä¸‹æ ‡ä¹Ÿä» $1$ å¼€å§‹ï¼‰ï¼š</p><ul><li>$sum[7] = ft[7] + ft[6] + ft[4]$<ul><li>7 çš„äºŒè¿›åˆ¶è¡¨ç¤º $111$</li><li>å®é™…ä¸Šï¼Œ$ft[7] = nums[7]$</li><li>å®é™…ä¸Šï¼Œ$ft[6] = nums[5] + nums[6]$</li><li>å®é™…ä¸Šï¼Œ$ft[4] = nums[1] + nums[2] + nums[3] + nums[4]$</li></ul></li><li>çœ‹äº†ä¸Šé¢ä¾‹å­ï¼Œå¯¹äº $ft[i]$ çš„æœ¬è´¨åŸºæœ¬æœ‰æ„Ÿè§‰äº†å§ ğŸ¤”ğŸ¤”<ul><li>$ft[i]$ è¡¨ç¤ºçš„æ˜¯ $nums[i - lowbit(i) + 1] + &mldr; + nums[i]$ çš„å’Œï¼ï¼ï¼</li><li>$ft[i]$ ç»´æŠ¤çš„æ˜¯åŒºé—´ $[i - lowbit(i) + 1, i]$ çš„æ€§è´¨</li></ul></li></ul><p>$lowbit(x)$ åœ¨è¿™æœŸé—´çš„ä½œç”¨ï¼Ÿ</p><ul><li>æ±‚å’ŒæœŸé—´ï¼šä»ä¸Šåˆ°ä¸‹ï¼Œå¿«é€Ÿè·³è½¬åˆ°ä¸‹ä¸€ä¸ªæ±‚å’ŒåŒºé—´</li><li>æ›´æ–°æœŸé—´ï¼šä»ä¸‹åˆ°ä¸Šï¼Œå¿«é€Ÿè·³è½¬åˆ°ä¸‹ä¸€å—å½±å“çš„åŒºé—´</li></ul><h1 id=åŒºé—´æœ€å€¼>åŒºé—´æœ€å€¼<a hidden class=anchor aria-hidden=true href=#åŒºé—´æœ€å€¼>#</a></h1><p>Whatï¼Ÿï¼Ÿï¼Ÿæ ‘çŠ¶æ•°ç»„å¯ä»¥æ±‚ä»»æ„åŒºé—´å’Œæ˜¯å¯ä»¥ç†è§£çš„ï¼šæ±‚ä¸¤æ¬¡å‰ç¼€å’Œï¼Œåšå·®å³å¯å¾—åˆ°åŒºé—´å’Œã€‚æ ‘çŠ¶æ•°ç»„æ±‚ä»»æ„åŒºé—´æœ€å€¼ï¼Ÿï¼ï¼</p><p>ä¸€å¼€å§‹ä¹Ÿæ˜¯ä¸ç›¸ä¿¡çš„ï¼Œç„¶è€Œäº‹å®æ˜¯ï¼Œåœ¨ç‰¹å®šåœºæ™¯ä¸‹æ˜¯å¯è¡Œçš„ï¼Œè€Œä¸”æ•ˆæœè¿˜ä¸é”™ã€‚</p><p>ç‰¹å®šåœºæ™¯ï¼šæ±‚åŒºé—´æœ€å°/å¤§å€¼æ—¶ï¼Œè¦æ±‚ä¿®æ”¹æ–¹å‘åªèƒ½æœç€å˜å°/å¤§çš„æ–¹å‘ä¿®æ”¹ï¼ˆçº¿æ®µæ ‘æ˜¯æ²¡æœ‰è¿™è¦æ±‚çš„ï¼‰ï¼Œè€ƒè™‘åŒºé—´æœ€å¤§å€¼ï¼š</p><ul><li>å•ç‚¹æ›´æ–°ä¸‹ $nums[5] = 100$ï¼Œ$ft[5]$ï¼Œ$ft[6]$ï¼Œ$ft[8]$ å‡å—åˆ°å½±å“ï¼Œæ›´æ–°ä¸º $100$ï¼Œè¿™æ²¡é—®é¢˜</li><li>æ¥ç€æ›´æ–°ä¸‹ $nums[5] = 99$ï¼ŒæŒ‰é“ç† $ft[5]$ï¼Œ$ft[6]$ï¼Œ$ft[8]$ å‡åº”æ›´æ–°ä¸º $99$ï¼Œä½†å®é™…æ˜¯ä¸ä¼šæ›´æ–°çš„ï¼Œè¿™æ­£æ˜¯é—®é¢˜æ‰€åœ¨ï¼</li></ul><h2 id=å®ç°>å®ç°<a hidden class=anchor aria-hidden=true href=#å®ç°>#</a></h2><p>è¿™é‡Œä»¥æ±‚åŒºé—´æœ€å¤§å€¼ä¸ºä¾‹ï¼Œæ ¸å¿ƒæ€æƒ³ï¼š</p><ul><li>æ›´æ–°çš„æ—¶å€™ä¸ä»…è¦ç»´æŠ¤æ ‘çŠ¶æ•°ç»„ $ft$ï¼Œè¿˜è¦ç»´æŠ¤åŸæ•°ç»„ $nums$</li><li>æŸ¥è¯¢çš„æ—¶å€™ $[p, r]$ æœ€å€¼æœ´ç´ åšæ³•ï¼šä»èµ·ç‚¹åˆ°ç»ˆç‚¹é€ä¸ªéå†ï¼Œå–æœ€å¤§å€¼å³å¯ï¼Œå¯ä»¥ä½¿ç”¨ $ft$ å¯¹å…¶è¿›è¡Œä¼˜åŒ–<ul><li>è‹¥ $ft[i]$ æ‰€ç®¡ç†çš„åŒºé—´åœ¨æŸ¥è¯¢åŒºé—´èŒƒå›´å†…ï¼šç”¨ $ft[i]$ ä»£è¡¨å…¶æ‰€ç®¡ç†çš„åŒºé—´å³å¯</li><li>å¦‚æœ $ft[i]$ æ‰€ç®¡ç†çš„åŒºé—´å¹¶æ²¡æœ‰å®Œå…¨åœ¨æŸ¥è¯¢åŒºé—´å†…ï¼Œå›åˆ°æœ´ç´ åšæ³•å³å¯ï¼Œç”¨åŸæ˜¯æ•°ç»„ä¸­çš„å…ƒç´ åšæ¯”è¾ƒå³å¯</li></ul></li></ul><p>ç¤ºä¾‹ï¼šæŸ¥è¯¢åŒºé—´ $[3, 7]$</p><ul><li>$ft[7]$ ç®¡ç†çš„èŒƒå›´æ˜¯ $[7, 7]$ï¼Œå®Œå…¨åœ¨æŸ¥è¯¢èŒƒå›´å†…</li><li>$ft[6]$ ç®¡ç†çš„èŒƒå›´æ˜¯ $[5, 6]$ï¼Œå®Œå…¨åœ¨æŸ¥è¯¢èŒƒå›´å†…</li><li>$ft[4]$ ç®¡ç†çš„èŒƒå›´æ˜¯ $[1, 4]$ï¼Œä¸å®Œå…¨åœ¨æŸ¥è¯¢èŒƒå›´å†…ï¼Œä½¿ç”¨åŸæ•°ç»„å…ƒç´ ä»£è¡¨ $nums[4]$</li><li>$ft[3]$ ç®¡ç†çš„èŒƒå›´æ˜¯ $[3, 3]$ï¼Œå®Œå…¨åœ¨æŸ¥è¯¢èŒƒå›´å†…</li><li>$max([3, 7]) = max(ft[7], ft[6], nums[4], ft[3])$</li></ul><h1 id=ç¦»æ•£åŒ–>ç¦»æ•£åŒ–<a hidden class=anchor aria-hidden=true href=#ç¦»æ•£åŒ–>#</a></h1><h2 id=ç»´æŠ¤ç¦»æ•£åŒºé—´>ç»´æŠ¤ç¦»æ•£åŒºé—´<a hidden class=anchor aria-hidden=true href=#ç»´æŠ¤ç¦»æ•£åŒºé—´>#</a></h2><p>å¸¸è§„ï¼šä¸‹æ ‡åŒºé—´æ˜¯è¿ç»­çš„ï¼Œç»´æŠ¤åŒºé—´ [5, 6] ä¹‹é—´çš„æœ€å€¼/å’Œ</p><p>å¦‚æœä¸‹æ ‡åŒºé—´ä¸è¿ç»­å‘¢ï¼š</p><ul><li>èŒƒå›´å°çš„è¯ï¼Œå£°æ˜ä¸€ä¸ªæ•°ç»„ï¼Œå½“æˆè¿ç»­çš„å°±å¯ä»¥äº†</li><li>èŒƒå›´ç‰¹åˆ«å¤§ï¼Œå°±æ²¡åŠæ³•å£°æ˜æ•°ç»„äº†</li></ul><p>è§£å†³åŠæ³•ï¼š</p><ul><li>å¯¹å‡ºç°è¿‡çš„ä¸‹æ ‡è¿›è¡Œæ’åºï¼Œæ’å®Œåºåï¼Œå»é‡</li><li>æ¯æ¬¡å…ˆç”¨äºŒåˆ†æŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾åˆ°å¯¹åº”çš„è¿ç»­ä¸‹æ ‡</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>//æ’åº
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>sort(diff.begin(), diff.end());
</span></span><span style=display:flex><span><span style=color:#75715e>//å»é‡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>diff.resize(unique(diff.begin(), diff.end()) <span style=color:#f92672>-</span> diff.begin());
</span></span><span style=display:flex><span>Fenwick <span style=color:#a6e22e>fw</span>(diff.size());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>long</span> <span style=color:#66d9ef>long</span> mx <span style=color:#f92672>=</span> LLONG_MIN;
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> n; <span style=color:#f92672>++</span>i) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>//ç¦»æ•£ä¸‹æ ‡è½¬åŒ–ä¸ºè¿ç»­ä¸‹æ ‡
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>int</span> j <span style=color:#f92672>=</span> lower_bound(diff.begin(), diff.end(), nums[i] <span style=color:#f92672>-</span> i) <span style=color:#f92672>-</span> diff.begin();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> <span style=color:#66d9ef>long</span> temp <span style=color:#f92672>=</span> fw.query(j <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>+</span> nums[i];
</span></span><span style=display:flex><span>    fw.update(j <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, temp);
</span></span><span style=display:flex><span>    mx <span style=color:#f92672>=</span> max(mx, temp);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=å°è£…>å°è£…<a hidden class=anchor aria-hidden=true href=#å°è£…>#</a></h1><p>æ”¯æŒåŒºé—´ å’Œã€ç§¯ã€ä¸å’Œã€æˆ–å’Œã€å¼‚æˆ–å’Œã€æœ€å¤§/å°å€¼ï¼ˆgcdï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼‰ç­‰åœºæ™¯çš„å•ç‚¹æ›´æ–°ï¼ŒåŒºé—´æŸ¥è¯¢æ“ä½œã€‚</p><p>åªæ”¯æŒâ€œå¢é‡æ›´æ–°ï¼ˆupdateï¼‰â€ï¼Œä¸æ”¯æŒ â€œè®¾ç½®æ›´æ–°ï¼ˆsetï¼‰â€ å³ä½¿æ”¯æŒè®¾ç½®æ›´æ–°ï¼Œä¹Ÿæ˜¯é€šè¿‡å¢é‡æ›´æ–°å®ç°çš„ï¼Œå¦‚ å’Œã€ä¹˜ç§¯ã€å¼‚æˆ–å’Œã€‚å…¶ä»–åœºæ™¯æ˜¯ç§»é™¤ä¸æ‰æ—§æœ‰å…ƒç´ å½±å“çš„ï¼Œä½¿ç”¨èµ·æ¥å…·æœ‰çº¦æŸï¼Œä»¥æœ€å€¼åœºæ™¯ä¸ºä¾‹:</p><ul><li>æœ€å¤§å€¼æŸ¥è¯¢ï¼šæ›´æ–°å€¼å¿…é¡»å¤§äºç­‰äºæ—§å€¼</li><li>æœ€å°å€¼æŸ¥è¯¢ï¼šæ›´æ–°å€¼å¿…é¡»å°äºç­‰äºæ—§å€¼</li></ul><p>åŸç† + å®ç°çš„æ—¶å€™åŸºäº 1-indexed æ›´å¥½ç†è§£ï¼Œæ¥å£å°è£…éƒ½æ˜¯ 0-indexed ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼ï¼ï¼</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>// Copyright (c) 2025 pk. All rights reserved.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Use of this source code is governed by a MIT license
</span></span></span><span style=display:flex><span><span style=color:#75715e>// if you like this code, don&#39;t delete this, thanks.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// identity variable template(C++14)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Op</span>, <span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>constexpr</span> <span style=color:#66d9ef>auto</span> identity_value <span style=color:#f92672>=</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// std::plus partial variable template specialization
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>constexpr</span> <span style=color:#66d9ef>auto</span> identity_value<span style=color:#f92672>&lt;</span>std<span style=color:#f92672>::</span>plus, T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> T(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// std::multiplies partial variable template specialization
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>constexpr</span> <span style=color:#66d9ef>auto</span> identity_value<span style=color:#f92672>&lt;</span>std<span style=color:#f92672>::</span>multiplies, T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> T(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// std::bit_and partial variable template specialization
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>constexpr</span> <span style=color:#66d9ef>auto</span> identity_value<span style=color:#f92672>&lt;</span>std<span style=color:#f92672>::</span>bit_and, T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> <span style=color:#f92672>~</span>T(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// std::bit_or partial variable template specialization
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>constexpr</span> <span style=color:#66d9ef>auto</span> identity_value<span style=color:#f92672>&lt;</span>std<span style=color:#f92672>::</span>bit_or, T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> T(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// std::bit_xor partial variable template specialization
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>constexpr</span> <span style=color:#66d9ef>auto</span> identity_value<span style=color:#f92672>&lt;</span>std<span style=color:#f92672>::</span>bit_xor, T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> T(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// maximum partial variable template specialization
</span></span></span><span style=display:flex><span><span style=color:#75715e>// std::maximum is function template, not types of functors
</span></span></span><span style=display:flex><span><span style=color:#75715e>// float type should use lowest() instead of min()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>maximum</span>  {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constexpr</span> T <span style=color:#a6e22e>operator</span>()(<span style=color:#66d9ef>const</span> T<span style=color:#f92672>&amp;</span> lhs, <span style=color:#66d9ef>const</span> T<span style=color:#f92672>&amp;</span> rhs) <span style=color:#66d9ef>const</span> { <span style=color:#66d9ef>return</span> std<span style=color:#f92672>::</span>max(lhs, rhs); }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>constexpr</span> <span style=color:#66d9ef>auto</span> identity_value<span style=color:#f92672>&lt;</span>maximum , T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>is_floating_point<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;::</span>value <span style=color:#f92672>?</span> std<span style=color:#f92672>::</span>numeric_limits<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;::</span>lowest() <span style=color:#f92672>:</span> std<span style=color:#f92672>::</span>numeric_limits<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;::</span>min();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// minimum partial variable template specialization
</span></span></span><span style=display:flex><span><span style=color:#75715e>// std::min is function template, not types of functors
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>minimum</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>constexpr</span> T <span style=color:#a6e22e>operator</span>()(<span style=color:#66d9ef>const</span> T<span style=color:#f92672>&amp;</span> lhs, <span style=color:#66d9ef>const</span> T<span style=color:#f92672>&amp;</span> rhs) <span style=color:#66d9ef>const</span> { <span style=color:#66d9ef>return</span> std<span style=color:#f92672>::</span>min(lhs, rhs);}
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>constexpr</span> <span style=color:#66d9ef>auto</span> identity_value<span style=color:#f92672>&lt;</span>minimum, T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>numeric_limits<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;::</span>max();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>template</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>typename</span><span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Op</span>, <span style=color:#66d9ef>typename</span> T<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FenwickTree</span> {
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>explicit</span> FenwickTree(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> n, <span style=color:#66d9ef>const</span> T<span style=color:#f92672>&amp;</span> init_value <span style=color:#f92672>=</span> identity_value<span style=color:#f92672>&lt;</span>Op, T<span style=color:#f92672>&gt;</span>) <span style=color:#f92672>:</span> ori(n, init_value), ft(n <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, identity_value<span style=color:#f92672>&lt;</span>Op, T<span style=color:#f92672>&gt;</span>) {
</span></span><span style=display:flex><span>        linear_init();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>explicit</span> <span style=color:#a6e22e>FenwickTree</span>(<span style=color:#66d9ef>const</span> std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;&amp;</span> nums) <span style=color:#f92672>:</span> ori(nums), ft(nums.size() <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, identity_value<span style=color:#f92672>&lt;</span>Op, T<span style=color:#f92672>&gt;</span>) {
</span></span><span style=display:flex><span>        linear_init();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 0-indexed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> T<span style=color:#f92672>&amp;</span> <span style=color:#66d9ef>operator</span>[](size_t idx) <span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> n <span style=color:#f92672>=</span> ori.size();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (idx <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> idx <span style=color:#f92672>&gt;=</span> n) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> std<span style=color:#f92672>::</span>out_of_range(<span style=color:#e6db74>&#34;index out of range&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ori[idx];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>bool</span> <span style=color:#a6e22e>update</span>(<span style=color:#66d9ef>int</span> idx, T x) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> n <span style=color:#f92672>=</span> ori.size();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(idx <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> idx <span style=color:#f92672>&gt;=</span> n) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> std<span style=color:#f92672>::</span>out_of_range(<span style=color:#e6db74>&#34;index out of range&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        ori[idx] <span style=color:#f92672>=</span> op(ori[idx], x);
</span></span><span style=display:flex><span>        idx<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span>(idx <span style=color:#f92672>&lt;</span> ft.size()) {
</span></span><span style=display:flex><span>            ft[idx] <span style=color:#f92672>=</span> op(ft[idx], x);
</span></span><span style=display:flex><span>            idx <span style=color:#f92672>+=</span> lowbit(idx);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> true;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 0-indexed [0, idx]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    T <span style=color:#a6e22e>query</span>(<span style=color:#66d9ef>int</span> idx) <span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// change to 1-indexed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        idx<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>        T res <span style=color:#f92672>=</span> identity_value<span style=color:#f92672>&lt;</span>Op, T<span style=color:#f92672>&gt;</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// special scene should return identity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>(idx <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span>) <span style=color:#66d9ef>return</span> res;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// avoid Out-of-bounds access
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>(idx <span style=color:#f92672>&gt;</span> ori.size()) idx <span style=color:#f92672>=</span> ori.size();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span>(idx) {
</span></span><span style=display:flex><span>            res <span style=color:#f92672>=</span> op(res, ft[idx]);
</span></span><span style=display:flex><span>            idx <span style=color:#f92672>-=</span> lowbit(idx);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> res;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 0-indexed [p, r]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    T <span style=color:#a6e22e>query</span>(<span style=color:#66d9ef>int</span> p, <span style=color:#66d9ef>int</span> r) <span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// change to 1-indexed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        p<span style=color:#f92672>++</span>, r<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> n <span style=color:#f92672>=</span> <span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span>(ori.size());
</span></span><span style=display:flex><span>        T res <span style=color:#f92672>=</span> identity_value<span style=color:#f92672>&lt;</span>Op, T<span style=color:#f92672>&gt;</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// special scene should return identity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>(p <span style=color:#f92672>&gt;</span> r <span style=color:#f92672>||</span> r <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>||</span> p <span style=color:#f92672>&gt;</span> n) <span style=color:#66d9ef>return</span> res;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// void Out-of-bounds access
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>(p <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span>) p <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(r <span style=color:#f92672>&gt;</span> n) r <span style=color:#f92672>=</span> n;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span>(p <span style=color:#f92672>&lt;=</span> r) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span>(p <span style=color:#f92672>&lt;=</span> r <span style=color:#f92672>-</span> lowbit(r)) {
</span></span><span style=display:flex><span>                res <span style=color:#f92672>=</span> op(res, ft[r]);
</span></span><span style=display:flex><span>                r <span style=color:#f92672>-=</span> lowbit(r);
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                res <span style=color:#f92672>=</span> op(res, ori[<span style=color:#f92672>--</span>r]);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> res;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>int</span> lowbit(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> x) { <span style=color:#66d9ef>return</span> x <span style=color:#f92672>&amp;</span> (<span style=color:#f92672>-</span>x); }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>linear_init</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> n <span style=color:#f92672>=</span> ori.size();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; i <span style=color:#f92672>&lt;=</span> n; <span style=color:#f92672>++</span>i) {
</span></span><span style=display:flex><span>            ft[i] <span style=color:#f92672>=</span> op(ft[i], ori[i <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> idx <span style=color:#f92672>=</span> i <span style=color:#f92672>+</span> lowbit(i);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span>(idx <span style=color:#f92672>&lt;=</span> n) ft[idx] <span style=color:#f92672>=</span> op(ft[idx], ft[i]);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> ori;
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> ft;
</span></span><span style=display:flex><span>    Op<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> op;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>ä½¿ç”¨ç¤ºä¾‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> identity_value<span style=color:#f92672>&lt;</span>maximum, <span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> identity_value<span style=color:#f92672>&lt;</span>minimum, <span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> identity_value<span style=color:#f92672>&lt;</span>maximum, <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> identity_value<span style=color:#f92672>&lt;</span>minimum, <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> identity_value<span style=color:#f92672>&lt;</span>maximum, <span style=color:#66d9ef>long</span> <span style=color:#66d9ef>long</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> identity_value<span style=color:#f92672>&lt;</span>minimum, <span style=color:#66d9ef>long</span> <span style=color:#66d9ef>long</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> identity_value<span style=color:#f92672>&lt;</span>maximum, <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>long</span> <span style=color:#66d9ef>long</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> identity_value<span style=color:#f92672>&lt;</span>minimum, <span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>long</span> <span style=color:#66d9ef>long</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> identity_value<span style=color:#f92672>&lt;</span>maximum, <span style=color:#66d9ef>float</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> identity_value<span style=color:#f92672>&lt;</span>minimum, <span style=color:#66d9ef>float</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> identity_value<span style=color:#f92672>&lt;</span>maximum, <span style=color:#66d9ef>double</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> identity_value<span style=color:#f92672>&lt;</span>minimum, <span style=color:#66d9ef>double</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>FenwickTree<span style=color:#f92672>&lt;</span>std<span style=color:#f92672>::</span>plus, <span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span> ft(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ft.update(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>ft.update(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>ft.update(<span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> ft.query(<span style=color:#ae81ff>9</span>) <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>FenwickTree<span style=color:#f92672>&lt;</span>minimum, <span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span> ft1(<span style=color:#ae81ff>10</span>);
</span></span></code></pre></div><p>åœ¨å®ç°å•ç‚¹æŸ¥è¯¢ã€åŒºé—´æŸ¥è¯¢æ—¶ï¼Œéœ€è¦æ³¨æ„ï¼š</p><ul><li>ä¸è¦ç€æ€¥ç›´æ¥ä½¿ç”¨ clamp å¤„ç†è¾¹ç•Œï¼Œåº”è¯¥å…ˆåˆ¤æ–­ç‰¹æ®Šåœºæ™¯<ul><li>å•ç‚¹æŸ¥è¯¢: <code>idx == -2</code> æ—¶ï¼Œå®é™…åº”è¯¥è¿”å›å•ä½å…ƒï¼Œå¦‚æœå…ˆ clamp åˆ° <code>idx == 0</code>, è¿”å›çš„å¹¶ä¸æ˜¯å•ä½å…ƒ</li><li>åŒºé—´æŸ¥è¯¢: <code>p > r || r &lt; 0 || p >= ori.size()</code> æ—¶éƒ½åº”è¯¥è¿”å›å•ä½å…ƒ</li></ul></li><li>åˆ¤æ–­å®Œç‰¹æ®Šåœºæ™¯ä¹‹åï¼Œéœ€è¦è¿›è¡Œ clampï¼Œé˜²æ­¢è®¿é—®è¶Šç•ŒåŒæ—¶ä¿è¯è®¡ç®—ç»“æœ<ul><li>å•ç‚¹æŸ¥è¯¢: <code>idx == ori.size() + 3</code> æ—¶ï¼Œè®¡ç®—å‰åº”è¯¥ clamp åˆ° <code>idx == ori.size() - 1</code> é˜²æ­¢è®¿é—®è¶Šç•Œ</li><li>åŒºé—´æŸ¥è¯¢: ç‰¹æ®Šåœºæ™¯åˆ¤æ–­å®Œä¹‹åï¼Œè¿˜æœ‰å¯èƒ½æ˜¯ <code>p &lt; 0 && r >= ori.size()</code> ç­‰åœºæ™¯ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦åš clamp çš„</li></ul></li></ul><h1 id=ç»ƒä¹ >ç»ƒä¹ <a hidden class=anchor aria-hidden=true href=#ç»ƒä¹ >#</a></h1><p>std::plus:</p><ul><li><a href=https://leetcode.cn/problems/peaks-in-array/>LeetCode 3187. æ•°ç»„ä¸­çš„å³°å€¼</a></li><li><a href=https://leetcode.cn/problems/maximum-sum-obtained-of-any-permutation/>LeetCode 1589. æ‰€æœ‰æ’åˆ—ä¸­çš„æœ€å¤§å’Œ</a></li><li><a href=https://leetcode.cn/problems/number-of-pairs-satisfying-inequality/>LeetCode 2426. æ»¡è¶³ä¸ç­‰å¼çš„æ•°å¯¹æ•°ç›®</a></li><li><a href=https://leetcode.cn/problems/count-good-triplets-in-an-array/>LeetCode 2179. ç»Ÿè®¡æ•°ç»„ä¸­å¥½ä¸‰å…ƒç»„æ•°ç›®</a></li><li><a href=https://leetcode.cn/problems/count-of-range-sum/>LeetCode 327. åŒºé—´å’Œçš„ä¸ªæ•°</a></li></ul><p>maximum:</p><ul><li><a href=https://leetcode.cn/problems/maximum-balanced-subsequence-sum/>LeetCode 2926. å¹³è¡¡å­åºåˆ—çš„æœ€å¤§å’Œ</a></li><li><a href=https://leetcode.cn/problems/longest-increasing-subsequence-ii>LeetCode 2407. æœ€é•¿é€’å¢å­åºåˆ— II</a></li></ul><p>std::bit_or:</p><ul><li><a href=https://leetcode.cn/problems/find-subarray-with-bitwise-or-closest-to-k/>LeetCode 3171. æ‰¾åˆ°æŒ‰ä½æˆ–æœ€æ¥è¿‘ K çš„å­æ•°ç»„</a></li></ul><p>std::bit_and:</p><ul><li><a href=https://leetcode.cn/problems/find-a-value-of-a-mysterious-function-closest-to-target/>LeetCode 1521. æ‰¾åˆ°æœ€æ¥è¿‘ç›®æ ‡å€¼çš„å‡½æ•°å€¼</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://dust-II.github.io/tags/%E6%A0%91/>æ ‘</a></li><li><a href=https://dust-II.github.io/tags/rmq/>Rmq</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://dust-II.github.io/>My Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>